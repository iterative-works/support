# PURPOSE: CI workflow that validates compilation of all modules on pull requests.
# PURPOSE: Ensures code compiles for both JVM and ScalaJS platforms before merge.

name: CI

on:
  pull_request:
    branches: [main]

jobs:
  compile:
    name: Compile
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java 21
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 21

      - name: Cache Coursier dependencies
        uses: actions/cache@v4
        with:
          path: ~/.cache/coursier
          key: ${{ runner.os }}-coursier-${{ hashFiles('build.mill') }}
          restore-keys: |
            ${{ runner.os }}-coursier-

      - name: Cache Mill
        uses: actions/cache@v4
        with:
          path: ~/.mill
          key: ${{ runner.os }}-mill-${{ hashFiles('.mill-version') }}
          restore-keys: |
            ${{ runner.os }}-mill-

      - name: Configure Nexus credentials
        run: |
          mkdir -p ~/.config/coursier
          echo "nexus.e-bs.cz ${{ secrets.EBS_NEXUS_USERNAME }}:${{ secrets.EBS_NEXUS_PASSWORD }}" > ~/.config/coursier/credentials.properties

      - name: Compile all modules
        run: ./mill __.compile
